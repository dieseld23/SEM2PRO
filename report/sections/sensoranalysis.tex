%!TEX root = ../main.tex

\section{Parameters of Interest}
\label{sec:parameters}
In developing new hardware or evaluating current hardware, it is necessary to be able to monitor associated parameters.
This section will investigate what parameters need to be logged in order to provide a useful and complete logging of the behavior of the go-kart.
The parameters in question fall into three categories; Translational parameters, electrical parameters and mechanical parameters.
\martin{What is translational parameters? Sounds like the opposite of rotational parameters, which in turn are both mechanical}
\catalin{I wouldn't put translational under the mech category.
I suggest translational->position and orientation or positioning or navigation.}
Clearly, developers may, in addition to the aforementioned categories, also have programmatic information, such as debug information from a motor controller.
This section will deal only with the physical parameters.
The three categories are dealt with in turn in the remainder of this section.
\subsection{Physical Parameters}
This category comprises all information about the motion of the go-kart.
\begin{itemize}
	\item \textbf{Position, Absolute:} Providing a means to record the absolute position of the go-kart is a useful feature in certain fields.
	Especially any form of localisation and path finding will be able to put this information to use.
	The absolute position of the go-kart can be recorded using a GPS module or possibly by using a known starting coordinate and information about the relative movement of the go-kart.
	\item \textbf{Position, Relative:} The relative position of the kart can be, as just mentioned, used to infer the absolute position of the go-kart.
	Additionally it can provide a means to analyze a drivers performance on track the or detect drift while cornoring.
	The relative position includes both translational, as well as rotational information.
	This information can be gathered using an inertial measurement unit (IMU).
	An IMU is a compound device, comprised of an accelerometer, a gyroscope and, in some cases, a magnetometer.
	\item \textbf{Velocity:} The velocity of the go-kart is key in optimising lap-times; clearly, it is desirable to monitor this parameter.
	It can be extracted by reading the motor encoders.
	However, the driving wheels are prone to slippage when cornoring, this would give an inaccurate reading of the actual velocity of the go-kart.
	Instead, a simple encoder can be mounted on either one, or both of the front wheels as these are freerunning and independent.
	Once the rotational speed of the axle is known, the velocity of the go-kart can be infered using the tyre diameter.
	\item \textbf{Acceleration and forces:} It may be of interest to monitor the forces exerted on the go-kart, or its acceleration, as it drives on the track.
	This information is already provided by the accelerometer in the IMU mentioned above and as such provides no additional complication.
\end{itemize}
Three sensors are mentioned in this section.
A GPS, an IMU and an encoder.
In order to limit the scope of the project only the GPS and the IMU will be implemented.
\subsection{Electrical Parameters}
This category comprises all information about the electrical aspects of the go-kart.
\begin{itemize}
	\item \textbf{Motor Currents:} Providing a means of monitoring the currents flowing through the motor allows the user to calculate the torque exerted by the motor as well as the current power draw of the motor.
	Knowing the currents could also prove an invaluable debugging tool when developing a new inverter for the go-kart.
	\item \textbf{Throttle Position:} The throttle on the go-kart is connected to a potentiometer.
	Measuring the voltage output of this potentiometer provides a simple way of monitoring the position of the throttle.
	\item \textbf{Desired Currents:} Based on the current throttle position a set of desired currents are calculated.
	Monitoring these allows spotting any discrepancies between the desired and the actual currents.
	\item \textbf{Voltage from Inverter:} Duty cycle is proportional to the voltage applied to the motor, and can be used to calculate the power going into the motor.
	\item \textbf{Battery Voltage:} As the go-kart is electrical, naturally, it has a battery.
	Monitoring the current battery status could give the user an indication of how much driving time is left, or how long until the batteries are recharged afterwards.
	\item \textbf{Motor Angle:} Knowing the angle of the motor at all times gives a means of more accurately calculate the currents at specific times.
	Additionally, it can be used in Clarke-Parke transformations, again, providing information in debugging an inverter in development.
\end{itemize}
These parameters are all available from the Sevcon Gen4 motor controller mounted on the go-kart.
This controller has a CANopen interface from which this data can be extracted.
Any users who wish to add their own inverter will simply need to obey the API for the appropriate node as stated in this report.
\subsection{Mechanical Information}
This category comprises all information about the mechanical aspects of the go-kart.
\begin{itemize}
	\item \textbf{Steering Wheel Angle:} Monitoring the angle of the steering wheel allows analysing the performance of the driver.
	In addition, with an actuator, it opens up for the possibility of remote control of the go-kart.
	Similarly to monitoring the velocity, the steering wheel angle can be monitored by adding an encoder to the steering column.
	\item \textbf{Braking Pedal Position:} The braking system on the go-kart is similar to that of an ordinary car.
	The braking disc is mounted on the driving axle and the braking calibers connected to the brake pedal by a series of oil-filled hoses.
	Monitoring its actuation allows analysing the performance of the driver and as mentioned above, may potentially allow for mechanical control of the go-kart
	\item \textbf{Temperature:} Certain parts of the go-kart directly impact driving performance with changing temperature.
	Additionally, overheating the motor, the batteries or tyres may cause expensive or dangerous failures.
\end{itemize}
As both monitoring of the steering wheel angle and the braking pedal position would require mechanical changes to the go-kart, they are beyond the scope of this project and as such will not be implemented.
The temperature of the motor and its controller is provided by the sevcon gen4.
All other temperatures would require installation of thermometers on the vehicle.

\subsection{Conclusion}
As mentioned in the beginning of the section, the parameters discussed throughout this section are limited to those that explain the physical aspects of the go-kart.
A future project may wish to introduce a data producer which does not directly gather data from a sensor, but generates a filtered output of other sensory equipment.
It is not possible to account for every parameter that a future developer may wish to add.
In order to provide a proof of concept for the system it was decided to implement the control for three data producers; the Sevcon Gen4 motor controller, an IMU and a GPS.

\section{Hardware for Monitoring Parameters}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤¤

\label{sec:hardware_for_par}
In section \ref{sec:parameters} an overview of the different parameters that may be of interest for logging is given.
It was concluded that three components would suffice as a proof of concept; the Sevcon Gen4 motor controller, an IMU and a GPS.
This section will explore in more detail what requirements and communication schemes that exist for each of the components.

\subsection{Sevcon Gen4 Motor Controller}
\label{sec:interfacin_with_sevcon}

The Sevcon Gen4 motor driver is a general purpose AC motor driver. 
This means, it can be used for both asynchronous and synchronous motors of a wide range of sizes.
The controller can then be set up for the particular motor and peripherals, and run without interfacing to another computer.
However, it is also possible to read data from it while running, and in some cases set values.
It is therefore possible to use this to access the electrical parameters. \\

The Sevcon communicates through CANopen, which is a high level protocol running on top of CAN.
This allows reading from and writing to a vast array of registers of varying length, which is described in further detail on page pageref~\ref{sub:CANopen}\\

\subsection{Inertial Measurement Unit (IMU)}
\label{sec:imu}
\mikkel{Maybe remove all requirements because we just took the available sensors}
\martin{I disagree. It's pretty straight forward to determine what the expected range is, and then set it $\frac{\mathring{\pi}}{\sqrt{3}}$ times bigger}
IMU's, generally, exist in two versions.
A 6D and a 9D version (Dimensions).
Both include an accelerometer and a gyroscope, each adding three dimensions.
In addition to these the 9D IMU includes a magnetometer, enabling measurement of absolute direction, as opposed to the relative measurement of direction given by the gyroscope.
The requirement in terms of each of these parts is given as:
\begin{itemize}
	\item \textbf{Accelerometer [\si{\metre\per\second^2}]:} As the name implies, the accelerometer measures accelerations.
	That is, when the component changes velocity the acceleration exerted on the IMU is measured.
	Professional drivers using professional grade go karts driving upwards of 250 \si{\kilo\metre\per\hour} can reach up to 2-3 g's of force exerted on them.
	The go kart available in this project has a maximum speed of 50 \si{\kilo\metre\per\hour}.
	Clearly, the forces exerted on this platform will be lower, however, a minimum requirement of $\pm$ 3g will be set for the accelerometer in the IMU.
	This will ensure that bumps in the road doesn't saturate the accelerometer
	\item \textbf{Gyroscope [\si{\degree\per\second}]:} 
	A gyroscope in this sense consists of three gyroscopes spinning at high velocity.
	When the IMU turns in around any of its axis, the change will be detected on one of the gyroscopes. 
	The gyroscope part of the IMU will mostly be useful for detecting change in inclination, turning the go kart, or spinning out.
	In the two former cases, the rate of change is fairly low, about 90 \si{\degree\per\second} for a sharp turn. 
	But in case the driver spins out, or oversteers, this number is much higher. 
	Therefore the minimum requirement of $\pm 360 \si{\degree\per\second}$.
	\item \textbf{Magnetometer [\si{\tesla}]:} 
	The magnetometer measures the magnetic flux density through the IMU.
	This is done by three hall sensors measuring the flux density along three axis. 
	This can be used to calculate the absolute orientation of the go-kart, both which way is north and which way is up.
	This type of sensor is notoriously noise sensitive.
	The flux density of the Earth's magnetic field ranges up to $65 \si{\micro\tesla}$.
	By comparison, this is several orders of magnitude lower than the magnetic field generated by the motor, so it's important to place the IMU away from the motor and high power wires.
	The scale of the magnetometer would need to be at least $\pm 75 \si{\micro \tesla}$.
\end{itemize}
Common for all sensors is, that the smallest range, that is larger than the requirements above, is preferred, as these will have finer resolution, while keeping the bitrate down.
The accelerometer measures the second derivative of translation with respect to time. 
The gyroscope measures the first derivative of rotation with respect to time.
This leaves three elements, that can be calculated: absolute translation (position), first derivative of translation (speed), absolute rotation (yaw, pitch and roll) and second derivative of rotation.
The absolute translation is measured by the GPS, and the others can be calculated by data fusion of the IMU measurements.\\

VN-100 from Vectornav is a 9D IMU with built in data processing to deduce more elements, that are not directly measurable.
Its ranges are generally much larger than the requirements, but at the same time, has fine enough resolution.
The accelerometer: 16 bits,  $\pm 16 \si{\meter \per \second \squared}$

\begin{table}
	\centering
	\begin{tabular}{ c | c c c}
		{\textbf{Sensor}} & {\textbf{Range}} & {\textbf{Bit}} & {\textbf{LSB}}\\
		\hline
		{Accelerometer}	& { $\pm 16 \mathrm{g}$}					& {16}	& {$< 0.5 \mathrm{g}$}\\
		{Gyroscope}		& { $\pm 2000\si{\degree \per \second}$ }	& {18}	& {$<0.02 \si{\degree \per \second}$}\\
		{Magnetometer}	& { $\pm 250 \si{\micro \tesla}$}			& {12}	& {$0.15 \si{\micro \tesla}$}
	\end{tabular}
	\caption{List of the resolution of the internal ADCs on the Vectornav VN-100}
	\label{tab:vectornav_measurement_resolution}
\end{table}

In addition to the IMU sensors, the VN-100 also records air pressure, which is of no concern to us.
Apart from the raw data listed above, the VN-100 can calculate other parameters, such as quaternions, yaw, pitch, roll, absolute heading and altitude.
I can also make the accelerometer data zero base, meaning when the go kart is standing still, 0g will be printed from the IMU, rather than the 1g caused by the gravitational pull of earth. \\

The Vectornav comes in a rugged, waterproof casing with a USB cable going out.
Drivers are available on Linux, where one can easily call functions to return the latest values on multiple axes at the same time.

\subsection{Global Positioning System (GPS)}
A GPS sensor is included on the Go Kart. 
The purpose of this is to give absolute position readings at fixed intervals, much like a runner would be able to see their route on a map afterwards.
However unlike a runner, a go kart is not supposed to drive at a constant speed nor in a straight line, and as such a GPS is likely too slow to be used on it's own.
The update rate of the position depends on the rate of messages sent out which is several seconds, which means that the GPS location is update at best a few times per second. 
The only parameter is then really the precision. \\

It was possible to borrow a GPS sensor from U-blox from Kjeld Jensen, the NEO-6P.
This has a data rate of 5 Hz, and a Circular Error Probability (CEP) of down to 2 m.
This means, that any position measurement has a 50 \% chance of being within a radius of 2 m from the actual position. 
This is very good compared to other GPS modules, but is barely precise enough to determine which side of a go kart track, the Go Kart starts in. 
Further precision is however a possibility using a base station, solutions, that U-blox does offer.\\

This is a tremendously good GPS module, and will give a good platform for data fusion, should later semester project want to work with this. 
One downside however is, that it only uses GPS, and not GLONASS or Galileo, which inherently limits the number of satellites visible to the node at any one point. 
Furthermore, a GPS module would only work outdoors, and the nearest Go Kart course to here is indoor, in which case a local position system would be preferred.\\

The U-blox NEO-6P is mounted on a custom made PCB with a min USB port and a connector for the antenna. 
Drivers are available for Linux, so that a stream of messages can be read out and converted to the correct data format.
\martin{verification}

\subsection{Conclusion}
Three sensors has been selected for this project, to be able to put something on the network.
The selected sensors are listed in table~\ref{tab:sensor_conclusion}.

\begin{table}[H]
	\centering
	\caption{Table of selected sensors}
	\label{tab:sensor_conclusion}
	\begin{tabular}{|l|l|l|}
		\hline
		\textbf{Sensor} & \textbf{Brand} & \textbf{Interface} \\
		\hline
		Motor controller & Sevcon Gen4 & CAN open \\ 
		\hline
		IMU & Vectornav VN-100 & USB, drivers for Linux\\
		\hline
		GPS & U-blox NEO-6p & USB, drivers for Linux\\
		\hline
	\end{tabular}
\end{table}
